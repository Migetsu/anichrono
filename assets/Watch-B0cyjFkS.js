import{C as e,D as t,E as n,I as r,M as ee,N as i,P as te,S as a,T as o,_ as s,b as c,f as l,g as ne,h as u,i as re,j as d,k as f,l as p,m,n as ie,p as h,r as ae,s as oe,t as se,v as g,w as _,x as ce,y as v}from"./index-5GYE3_r7.js";import{t as y}from"./purify.es-B9hZV_m9.js";import{t as le}from"./searchAnimeById-BWUfyleL.js";var ue={key:0,class:`watch`},de={class:`container`},fe={class:`watch__video`},pe={class:`watch__video-container`},me={key:0,class:`watch__video-player`},he=[`src`],ge={key:0,class:`youtube-fallback`},_e={class:`youtube-fallback__content`},ve={class:`youtube-fallback__icon`},ye=[`href`],be={key:1,class:`watch__video-placeholder`},xe={key:0},Se={key:1},b={key:2},x={class:`watch__info`},S={class:`anime__details`},C={class:`anime__details-title`},w={class:`anime__details-meta`},T={class:`meta-item`},E={class:`meta-value`},D={class:`meta-item`},O={class:`meta-value`},k={class:`meta-item`},A={class:`meta-value`},j={class:`meta-item`},Ce={class:`meta-value`},we={class:`meta-item`},Te={class:`meta-value`},Ee={class:`anime__details-genres`},De=[`innerHTML`],Oe={class:`action-buttons`},ke={key:0,class:`dropdown`},Ae={class:`btn-text`},je={key:1,class:`dropdown__separator`},Me=[`onClick`],Ne={class:`action-btn secondary-btn`},Pe={class:`watch__info-sidebar`},Fe={class:`sidebar-section`},Ie={class:`sidebar-title`},Le={class:`trailer__list`},Re=[`onClick`],ze={class:`trailer__thumbnail`},Be=[`src`,`alt`],Ve={key:1,class:`trailer__image-placeholder`},He={class:`trailer__play-overlay`},Ue={class:`trailer__info`},We={class:`trailer__number`},Ge={class:`trailer__title`},Ke={class:`trailer__kind`},qe=[`href`],Je={key:0,class:`trailer__list-empty`},Ye={key:0},Xe={key:1},Ze={class:`sidebar-section sidebar-settings`},Qe={class:`sidebar-title`},M={class:`video-settings__content`},$e={class:`video-settings__item`},et={class:`video-settings__dropdown`},tt=[`value`],nt={class:`video-settings__item`},rt={class:`video-settings__dropdown`},it=[`value`],at={class:`video-settings__item`},ot={class:`video-settings__toggle`},st=[`checked`],N=ie(Object.assign({inheritAttrs:!1},{__name:`Watch`,setup(ie){let N=oe(),P=ae(),F=re(),I=d(null),L=d(!0),R=d(``),z={planned:`Запланировано`,watching:`Смотрю`,rewatching:`Пересматриваю`,completed:`Просмотрено`,on_hold:`Отложено`,dropped:`Брошено`},ct=[{label:z.planned,value:`planned`},{label:z.watching,value:`watching`},{label:z.rewatching,value:`rewatching`},{label:z.completed,value:`completed`},{label:z.on_hold,value:`on_hold`},{label:z.dropped,value:`dropped`}];async function lt(e){L.value=!0,R.value=``,I.value=null;try{I.value=await le(e)}catch(e){R.value=String(e?.message||e)}finally{L.value=!1}}t(()=>N.params.id,e=>{e!=null&&lt(Number(e))},{immediate:!0});let ut=[`div`,`p`,`br`,`a`,`span`,`strong`,`b`,`em`,`i`,`ul`,`ol`,`li`],dt=[`href`,`title`];y.addHook(`afterSanitizeAttributes`,e=>{e.removeAttribute?.(`class`),e.removeAttribute?.(`style`),[...e.attributes||[]].forEach(t=>t.name?.startsWith?.(`data-`)&&e.removeAttribute(t.name)),e.tagName===`A`&&e.hasAttribute(`href`)&&(e.setAttribute(`target`,`_blank`),e.setAttribute(`rel`,`noopener noreferrer nofollow`))});let ft=m(()=>{let e=I.value?.descriptionHtml||``;return e?y.sanitize(e,{ALLOWED_TAGS:ut,ALLOWED_ATTR:dt,USE_PROFILES:{html:!0}}):``}),B=d(!1),V=d(null),H=d(!1);async function U(){let e=Number(I.value?.id);if(!P.isLoggedIn||!e){V.value=null;return}let t=F.rateFor(e);if(t){V.value=t;return}if(!F.loading&&F.rates.length===0){await F.ensureRates();let t=F.rateFor(e);if(t){V.value=t;return}}try{H.value=!0,V.value=await F.fetchRateForTarget(Number(e))||null}finally{H.value=!1}}let W;t([()=>P.isLoggedIn,()=>P.token,()=>P.user?.id,()=>I.value?.id,()=>F.rates.length],()=>{clearTimeout(W),W=setTimeout(U,0)},{immediate:!0}),e(()=>clearTimeout(W));let G=e=>{B.value&&!e.target.closest(`.dropdown`)&&(B.value=!1)};a(()=>{document.addEventListener(`click`,G)}),e(()=>{document.removeEventListener(`click`,G)});let pt=m(()=>P.isLoggedIn?H.value||F.loading?`Загрузка…`:V.value?z[V.value.status]??`В списке`:`Добавить в список`:`Добавить в список`),mt=e=>({planned:`fa-solid fa-clock`,watching:`fa-solid fa-play`,rewatching:`fa-solid fa-rotate-right`,completed:`fa-solid fa-check-circle`,on_hold:`fa-solid fa-pause`,dropped:`fa-solid fa-xmark-circle`})[e]||`fa-solid fa-list`;async function ht(e){I.value&&(await F.setStatus(I.value,e),await U(),B.value=!1)}async function gt(){I.value&&(await F.remove(Number(I.value.id)),await U(),B.value=!1)}let K=m(()=>I.value?.videos?I.value.videos.filter(e=>e.kind===`pv`):[]),q=d(0),J=m(()=>K.value.length===0?null:K.value[q.value]||null);function _t(e){e>=0&&e<K.value.length&&(q.value=e,$.value=!1,Q.value=!1)}t(()=>I.value?.videos,()=>{K.value.length>0&&(q.value=0,$.value=!1,Q.value=!1)},{immediate:!0}),t(()=>J.value,e=>{if(e){$.value=!1,Q.value=!1;let e=setTimeout(()=>{$.value||(Q.value=!0)},5e3);return()=>clearTimeout(e)}});let vt=[`1080p`,`720p`,`480p`],Y=d(`720p`),yt=[{value:.25,label:`0.25x`},{value:.5,label:`0.5x`},{value:.75,label:`0.75x`},{value:1,label:`1x (нормально)`},{value:1.25,label:`1.25x`},{value:1.5,label:`1.5x`},{value:1.75,label:`1.75x`},{value:2,label:`2x`}],X=d(1),Z=d(!1),Q=d(!1),$=d(!1);function bt(e){Y.value=e}function xt(e){X.value=e}function St(e){Z.value=e.target.checked}function Ct(){$.value=!0,Q.value=!1}function wt(){$.value=!1,Q.value=!0}function Tt(e){if(!e)return null;for(let t of[/(?:youtube\.com\/watch\?v=|youtu\.be\/|youtube\.com\/embed\/)([^&\n?#]+)/,/youtube\.com\/v\/([^&\n?#]+)/,/youtube\.com\/watch\?.*v=([^&\n?#]+)/]){let n=e.match(t);if(n)return n[1]}return null}return(e,t)=>{let a=n(`font-awesome-icon`);return _(),g(`div`,te(ce(e.$attrs)),[I.value?(_(),g(`main`,ue,[u(`div`,de,[u(`section`,fe,[u(`div`,pe,[J.value?(_(),g(`div`,me,[u(`iframe`,{src:`https://www.youtube.com/embed/${Tt(J.value.url)}?rel=0&modestbranding=1&showinfo=0`,frameborder:`0`,allowfullscreen:``,class:`trailer-iframe`,loading:`lazy`,allow:`accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture`,onLoad:Ct,onError:wt},null,40,he),Q.value?(_(),g(`div`,ge,[u(`div`,_e,[u(`div`,ve,[c(a,{icon:`fa-brands fa-youtube`})]),t[8]||=u(`div`,{class:`youtube-fallback__text`},[u(`h4`,null,`Проблемы с воспроизведением?`),u(`p`,null,`Если видео не загружается, откройте трейлер на YouTube`)],-1),u(`a`,{href:J.value.url,target:`_blank`,rel:`noopener noreferrer`,class:`youtube-fallback__btn`},[c(a,{icon:`fa-solid fa-external-link-alt`}),t[7]||=v(` Открыть на YouTube `,-1)],8,ye)])])):s(``,!0)])):(_(),g(`div`,be,[c(a,{icon:`fa-solid fa-video`,class:`placeholder-icon`}),t[9]||=u(`h3`,null,`Трейлеры недоступны`,-1),I.value?.videos?.length===0?(_(),g(`p`,xe,`Для этого аниме нет доступных трейлеров`)):I.value?.videos?.length>0?(_(),g(`p`,Se,`Найдено `+r(I.value.videos.length)+` видео, но нет PV трейлеров`,1)):(_(),g(`p`,b,`Загрузка информации о трейлерах...`))]))])]),u(`section`,x,[u(`div`,S,[u(`h1`,C,r(I.value.russian||I.value.name),1),u(`div`,w,[u(`div`,T,[u(`div`,E,r(I.value.score),1),t[10]||=u(`div`,{class:`meta-label`},`Рейтинг`,-1)]),u(`div`,D,[u(`div`,O,r(I.value.airedOn.year),1),t[11]||=u(`div`,{class:`meta-label`},`Год`,-1)]),u(`div`,k,[u(`div`,A,r(I.value.episodes),1),t[12]||=u(`div`,{class:`meta-label`},`Серий`,-1)]),u(`div`,j,[u(`div`,Ce,r(I.value.duration)+` мин.`,1),t[13]||=u(`div`,{class:`meta-label`},`Длительность`,-1)]),u(`div`,we,[u(`div`,Te,r(I.value.status),1),t[14]||=u(`div`,{class:`meta-label`},`Статус`,-1)])]),u(`div`,Ee,[(_(!0),g(h,null,o(I.value.genres,(e,t)=>(_(),g(`span`,{key:t},r(e.russian||e.name),1))),128))]),u(`div`,{class:`anime__details-desc`,innerHTML:ft.value},null,8,De),u(`div`,Oe,[ee(P).isLoggedIn?(_(),g(`div`,ke,[u(`button`,{class:i([`anime__list-btn`,{active:B.value}]),onClick:t[0]||=e=>B.value=!B.value},[c(a,{icon:`fa-solid fa-list-check`,class:`btn-icon`}),u(`span`,Ae,r(pt.value),1),c(a,{icon:`fa-solid fa-chevron-down`,class:i([`btn-arrow`,{rotated:B.value}])},null,8,[`class`])],2),B.value?(_(),g(`div`,{key:0,class:`dropdown__menu`,onClick:t[1]||=l(()=>{},[`stop`])},[V.value?(_(),g(`div`,{key:0,class:`dropdown__item dropdown__item--remove`,onClick:gt},[c(a,{icon:`fa-solid fa-trash`,class:`item-icon`}),t[15]||=u(`span`,null,`Удалить из списка`,-1)])):s(``,!0),V.value?(_(),g(`div`,je)):s(``,!0),(_(),g(h,null,o(ct,e=>u(`div`,{key:e.value,class:i([`dropdown__item`,{active:V.value?.status===e.value}]),onClick:t=>ht(e.value)},[c(a,{icon:mt(e.value),class:`item-icon`},null,8,[`icon`]),u(`span`,null,r(e.label),1),V.value?.status===e.value?(_(),ne(a,{key:0,icon:`fa-solid fa-check`,class:`item-check`})):s(``,!0)],10,Me)),64))])):s(``,!0)])):s(``,!0),u(`button`,Ne,[c(a,{icon:`fa-solid fa-share`,class:`action-btn-icon`}),t[16]||=v(` Поделиться `,-1)])])]),u(`div`,Pe,[u(`div`,Fe,[u(`h3`,Ie,[c(a,{icon:`fa-solid fa-video`,class:`sidebar-title-icon`}),t[17]||=v(` Трейлеры `,-1)]),u(`div`,Le,[(_(!0),g(h,null,o(K.value,(e,n)=>(_(),g(`div`,{key:e.id,class:i([`trailer__list-item`,{active:q.value===n}]),onClick:e=>_t(n)},[u(`div`,ze,[e.imageUrl?(_(),g(`img`,{key:0,src:e.imageUrl,alt:e.name,class:`trailer__image`},null,8,Be)):(_(),g(`div`,Ve,[c(a,{icon:`fa-solid fa-play`})])),u(`div`,He,[c(a,{icon:`fa-solid fa-play`})])]),u(`div`,Ue,[u(`span`,We,r(n+1)+`.`,1),u(`span`,Ge,r(e.name||`Трейлер ${n+1}`),1),u(`span`,Ke,r(e.kind?.toUpperCase()),1),e.url?(_(),g(`a`,{key:0,href:e.url,target:`_blank`,rel:`noopener noreferrer`,class:`trailer__direct-link`,onClick:t[2]||=l(()=>{},[`stop`])},[c(a,{icon:`fa-solid fa-external-link-alt`}),t[18]||=v(` YouTube `,-1)],8,qe)):s(``,!0)])],10,Re))),128)),K.value.length===0?(_(),g(`div`,Je,[c(a,{icon:`fa-solid fa-video-slash`}),I.value?.videos?.length===0?(_(),g(`span`,Ye,`Трейлеры недоступны`)):(_(),g(`span`,Xe,`Нет PV трейлеров (найдено `+r(I.value?.videos?.length||0)+` других видео)`,1))])):s(``,!0)])]),u(`div`,Ze,[u(`h3`,Qe,[c(a,{icon:`fa-solid fa-gear`,class:`sidebar-title-icon`}),t[19]||=v(` Настройки `,-1)]),u(`div`,M,[u(`div`,$e,[t[20]||=u(`label`,{class:`video-settings__label`},`Качество видео`,-1),u(`div`,et,[f(u(`select`,{"onUpdate:modelValue":t[3]||=e=>Y.value=e,onChange:t[4]||=e=>bt(Y.value),class:`video-settings__select`},[(_(),g(h,null,o(vt,e=>u(`option`,{key:e,value:e},r(e),9,tt)),64))],544),[[p,Y.value]]),c(a,{icon:`fa-solid fa-chevron-down`,class:`video-settings__dropdown-icon`})])]),u(`div`,nt,[t[21]||=u(`label`,{class:`video-settings__label`},`Скорость воспроизведения`,-1),u(`div`,rt,[f(u(`select`,{"onUpdate:modelValue":t[5]||=e=>X.value=e,onChange:t[6]||=e=>xt(X.value),class:`video-settings__select`},[(_(),g(h,null,o(yt,e=>u(`option`,{key:e.value,value:e.value},r(e.label),9,it)),64))],544),[[p,X.value]]),c(a,{icon:`fa-solid fa-chevron-down`,class:`video-settings__dropdown-icon`})])]),u(`div`,at,[t[23]||=u(`label`,{class:`video-settings__label`},`Субтитры`,-1),u(`div`,ot,[u(`input`,{type:`checkbox`,id:`subtitles-sidebar`,checked:Z.value,onChange:St,class:`video-settings__checkbox`},null,40,st),t[22]||=u(`label`,{for:`subtitles-sidebar`,class:`video-settings__toggle-label`},[u(`span`,{class:`video-settings__toggle-slider`})],-1)])])])])])])])])):s(``,!0),c(se)],16)}}}),[[`__scopeId`,`data-v-ce693f16`]]);export{N as default};