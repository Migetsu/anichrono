import{E as e,I as t,N as n,O as r,S as i,T as a,_ as o,b as s,h as c,j as l,m as u,n as d,p as f,r as p,t as m,v as h,w as g,y as _}from"./index-5GYE3_r7.js";var v={class:`history-page`},y={class:`history-container`},b={class:`history-header`},x={class:`history-title`},S={class:`history-filters`},C={class:`filter-count`},w={class:`filter-count`},T={class:`filter-count`},E={class:`filter-count`},D={class:`history-content`},O={key:0,class:`loading-state`},k={key:1,class:`error-state`},A={key:2,class:`empty-state`},j={key:3,class:`history-timeline`},M={class:`timeline-content`},N={class:`timeline-meta`},P={class:`timeline-action`},F={class:`timeline-date`},I=d({__name:`HistoryPage`,setup(d){let I=p(),L=l([]),R=l(!1),z=l(null),B=l(`all`),V=l(1),H=l(!0);async function U(e=1){if(I?.user?.id){R.value=!0,z.value=null;try{let t=await fetch(`/api/user-history?user_id=${I.user.id}&limit=50&page=${e}`);if(t.ok){let n=await t.json();if(n.length===0)H.value=!1;else{let t=n.map(e=>({anime_id:e.target?.id||0,anime_title:e.target?.russian||e.target?.name||`Аниме #${e.target?.id}`,action:e.description||``,status:G(e.description),date:e.created_at}));e===1?L.value=t:L.value.push(...t),H.value=n.length===50}}else z.value=`Не удалось загрузить историю`}catch(e){console.error(`Ошибка загрузки истории:`,e),z.value=`Произошла ошибка при загрузке истории`}finally{R.value=!1}}}function W(){V.value++,U(V.value)}function G(e){if(!e)return``;for(let[t,n]of Object.entries({Запланировано:`planned`,Смотрю:`watching`,Просмотрено:`completed`,Отложено:`on_hold`,Брошено:`dropped`,Пересматриваю:`rewatching`}))if(e.includes(t))return t;return e}let K=u(()=>B.value===`all`?L.value:L.value.filter(e=>{let t=e.action.toLowerCase();return B.value===`add`?t.includes(`добавлен`)||t.includes(`добавлено`):B.value===`remove`?t.includes(`удален`)||t.includes(`удалено`):B.value===`change`?t.includes(`изменен`)||t.includes(`изменено`)||!t.includes(`добавлен`)&&!t.includes(`удален`):!0})),q=u(()=>L.value.filter(e=>e.action.toLowerCase().includes(`добавлен`)||e.action.toLowerCase().includes(`добавлено`)).length),J=u(()=>L.value.filter(e=>e.action.toLowerCase().includes(`удален`)||e.action.toLowerCase().includes(`удалено`)).length),Y=u(()=>L.value.filter(e=>{let t=e.action.toLowerCase();return t.includes(`изменен`)||t.includes(`изменено`)||!t.includes(`добавлен`)&&!t.includes(`удален`)}).length);function X(e){return e.includes(`Добавлено`)||e.includes(`добавлен`)?`fa-solid fa-plus`:e.includes(`Удалено`)||e.includes(`удален`)?`fa-solid fa-trash`:e.includes(`Изменено`)||e.includes(`изменен`)?`fa-solid fa-pen`:`fa-solid fa-clock`}function Z(e){return e.includes(`Добавлено`)||e.includes(`добавлен`)?`action-add`:e.includes(`Удалено`)||e.includes(`удален`)?`action-remove`:`action-change`}function Q(e){if(!e)return``;let t=new Date(e),n=new Date,r=Math.floor((n-t)/1e3);return r<60?`только что`:r<3600?`${Math.floor(r/60)} мин назад`:r<86400?`${Math.floor(r/3600)} ч назад`:r<604800?`${Math.floor(r/86400)} дн назад`:t.toLocaleDateString(`ru-RU`,{day:`numeric`,month:`long`,year:`numeric`,hour:`2-digit`,minute:`2-digit`})}return i(()=>{U()}),(i,l)=>{let u=e(`font-awesome-icon`),d=e(`RouterLink`);return g(),h(f,null,[c(`main`,v,[c(`div`,y,[c(`header`,b,[s(d,{to:`/profile`,class:`back-btn`},{default:r(()=>[s(u,{icon:`fa-solid fa-arrow-left`}),l[4]||=_(` Назад к профилю `,-1)]),_:1}),c(`h1`,x,[s(u,{icon:`fa-solid fa-clock-rotate-left`}),l[5]||=_(` История изменений `,-1)])]),c(`div`,S,[c(`button`,{class:n([`filter-btn`,{active:B.value===`all`}]),onClick:l[0]||=e=>B.value=`all`},[s(u,{icon:`fa-solid fa-list`}),l[6]||=_(` Все `,-1),c(`span`,C,t(L.value.length),1)],2),c(`button`,{class:n([`filter-btn`,{active:B.value===`add`}]),onClick:l[1]||=e=>B.value=`add`},[s(u,{icon:`fa-solid fa-plus`}),l[7]||=_(` Добавлено `,-1),c(`span`,w,t(q.value),1)],2),c(`button`,{class:n([`filter-btn`,{active:B.value===`remove`}]),onClick:l[2]||=e=>B.value=`remove`},[s(u,{icon:`fa-solid fa-trash`}),l[8]||=_(` Удалено `,-1),c(`span`,T,t(J.value),1)],2),c(`button`,{class:n([`filter-btn`,{active:B.value===`change`}]),onClick:l[3]||=e=>B.value=`change`},[s(u,{icon:`fa-solid fa-pen`}),l[9]||=_(` Изменено `,-1),c(`span`,E,t(Y.value),1)],2)]),c(`div`,D,[R.value?(g(),h(`div`,O,[s(u,{icon:`fa-solid fa-spinner`,spin:``}),l[10]||=_(` Загрузка истории... `,-1)])):z.value?(g(),h(`div`,k,[s(u,{icon:`fa-solid fa-exclamation-circle`}),_(` `+t(z.value),1)])):K.value.length===0?(g(),h(`div`,A,[s(u,{icon:`fa-regular fa-folder-open`}),l[11]||=c(`p`,null,`История изменений пуста`,-1)])):(g(),h(`div`,j,[(g(!0),h(f,null,a(K.value,(e,i)=>(g(),h(`div`,{key:i,class:`timeline-item`},[c(`div`,{class:n([`timeline-icon`,Z(e.action)])},[s(u,{icon:X(e.action)},null,8,[`icon`])],2),c(`div`,M,[s(d,{to:`/animes/${e.anime_id}`,class:`timeline-title`},{default:r(()=>[_(t(e.anime_title),1)]),_:2},1032,[`to`]),c(`div`,N,[c(`span`,P,t(e.action),1),c(`span`,F,t(Q(e.date)),1)])])]))),128))])),!R.value&&H.value&&K.value.length>0?(g(),h(`button`,{key:4,onClick:W,class:`load-more-btn`},[s(u,{icon:`fa-solid fa-chevron-down`}),l[12]||=_(` Загрузить еще `,-1)])):o(``,!0)])])]),s(m)],64)}}},[[`__scopeId`,`data-v-b2dcb615`]]);export{I as default};