import{C as e,D as t,E as n,I as r,M as ee,N as i,O as te,S as a,T as o,_ as s,b as c,f as ne,g as re,h as l,i as u,j as d,m as f,n as p,p as m,r as ie,s as ae,t as oe,v as h,w as g,y as _}from"./index-5GYE3_r7.js";import{t as v}from"./purify.es-B9hZV_m9.js";import{t as se}from"./searchAnimeById-BWUfyleL.js";var ce={class:`anime`},le={class:`anime-container`},ue={key:0,class:`anime__info`},de={class:`anime__info-left`},fe={class:`anime__info-poster`},y=[`src`],b={class:`anime__info-status`},x={key:0,class:`dropdown`},S={class:`btn-text`},C={key:1,class:`dropdown__separator`},w=[`onClick`],T={class:`anime__info-content`},E=[`title`],D={class:`anime__info-meta`},O={class:`meta-item`},k={class:`meta-value`},A={class:`meta-item`},j={class:`meta-value`},M={class:`meta-item`},N={class:`meta-value`},P={class:`meta-item`},F={class:`meta-value`},I={class:`meta-item`},L={class:`meta-value`},R={class:`anime__info-genres`},pe=[`innerHTML`],z={class:`anime__info-btns`},B={class:`anime__info-btn secondary-btn`},V=p({__name:`AnimeTitle`,setup(p){let V=ae(),H=ie(),U=u(),W=d(null),G=d(!0),K=d(``),q={planned:`Запланировано`,watching:`Смотрю`,rewatching:`Пересматриваю`,completed:`Просмотрено`,on_hold:`Отложено`,dropped:`Брошено`},me=[{label:q.planned,value:`planned`},{label:q.watching,value:`watching`},{label:q.rewatching,value:`rewatching`},{label:q.completed,value:`completed`},{label:q.on_hold,value:`on_hold`},{label:q.dropped,value:`dropped`}];async function he(e){G.value=!0,K.value=``,W.value=null;try{W.value=await se(e)}catch(e){K.value=String(e?.message||e)}finally{G.value=!1}}t(()=>V.params.id,e=>{e!=null&&he(Number(e))},{immediate:!0});let ge=[`div`,`p`,`br`,`a`,`span`,`strong`,`b`,`em`,`i`,`ul`,`ol`,`li`],_e=[`href`,`title`];v.addHook(`afterSanitizeAttributes`,e=>{e.removeAttribute?.(`class`),e.removeAttribute?.(`style`),[...e.attributes||[]].forEach(t=>t.name?.startsWith?.(`data-`)&&e.removeAttribute(t.name)),e.tagName===`A`&&e.hasAttribute(`href`)&&(e.setAttribute(`target`,`_blank`),e.setAttribute(`rel`,`noopener noreferrer nofollow`))});let ve=f(()=>{let e=W.value?.descriptionHtml||``;return e?v.sanitize(e,{ALLOWED_TAGS:ge,ALLOWED_ATTR:_e,USE_PROFILES:{html:!0}}):``}),J=d(!1),Y=d(null),X=d(!1);async function Z(){let e=Number(W.value?.id);if(!H.isLoggedIn||!e){Y.value=null;return}let t=U.rateFor(e);if(t){Y.value=t;return}if(!U.loading&&U.rates.length===0){await U.ensureRates();let t=U.rateFor(e);if(t){Y.value=t;return}}try{X.value=!0,Y.value=await U.fetchRateForTarget(Number(e))||null}finally{X.value=!1}}let Q;t([()=>H.isLoggedIn,()=>H.token,()=>H.user?.id,()=>W.value?.id,()=>U.rates.length],()=>{clearTimeout(Q),Q=setTimeout(Z,0)},{immediate:!0}),e(()=>clearTimeout(Q));let $=e=>{J.value&&!e.target.closest(`.dropdown`)&&(J.value=!1)};a(()=>{document.addEventListener(`click`,$)}),e(()=>{document.removeEventListener(`click`,$)});let ye=f(()=>H.isLoggedIn?X.value||U.loading?`Загрузка…`:Y.value?q[Y.value.status]??`В списке`:`Добавить в список`:`Добавить в список`),be=e=>({planned:`fa-solid fa-clock`,watching:`fa-solid fa-play`,rewatching:`fa-solid fa-rotate-right`,completed:`fa-solid fa-check-circle`,on_hold:`fa-solid fa-pause`,dropped:`fa-solid fa-xmark-circle`})[e]||`fa-solid fa-list`;async function xe(e){W.value&&(await U.setStatus(W.value,e),await Z(),J.value=!1)}async function Se(){W.value&&(await U.remove(Number(W.value.id)),await Z(),J.value=!1)}return f(()=>{let e=Number(W.value.episodes);return!e||e<=0?[]:Array.from({length:e},(e,t)=>t+1)}),(e,t)=>{let a=n(`font-awesome-icon`),u=n(`router-link`);return g(),h(m,null,[l(`main`,ce,[l(`div`,le,[W.value?(g(),h(`section`,ue,[l(`div`,de,[l(`div`,fe,[l(`img`,{src:W.value.poster?.originalUrl,alt:``},null,8,y),l(`div`,b,r(W.value.status),1)]),ee(H).isLoggedIn?(g(),h(`div`,x,[l(`button`,{class:i([`anime__list-btn`,{active:J.value}]),onClick:t[0]||=e=>J.value=!J.value},[c(a,{icon:`fa-solid fa-list-check`,class:`btn-icon`}),l(`span`,S,r(ye.value),1),c(a,{icon:`fa-solid fa-chevron-down`,class:i([`btn-arrow`,{rotated:J.value}])},null,8,[`class`])],2),J.value?(g(),h(`div`,{key:0,class:`dropdown__menu`,onClick:t[1]||=ne(()=>{},[`stop`])},[Y.value?(g(),h(`div`,{key:0,class:`dropdown__item dropdown__item--remove`,onClick:Se},[c(a,{icon:`fa-solid fa-trash`,class:`item-icon`}),t[2]||=l(`span`,null,`Удалить из списка`,-1)])):s(``,!0),Y.value?(g(),h(`div`,C)):s(``,!0),(g(),h(m,null,o(me,e=>l(`div`,{key:e.value,class:i([`dropdown__item`,{active:Y.value?.status===e.value}]),onClick:t=>xe(e.value)},[c(a,{icon:be(e.value),class:`item-icon`},null,8,[`icon`]),l(`span`,null,r(e.label),1),Y.value?.status===e.value?(g(),re(a,{key:0,icon:`fa-solid fa-check`,class:`item-check`})):s(``,!0)],10,w)),64))])):s(``,!0)])):s(``,!0)]),l(`div`,T,[l(`div`,null,[l(`h1`,{class:`anime__info-title`,title:W.value.russian||W.value.name},r(W.value.russian||W.value.name),9,E),l(`div`,D,[l(`div`,O,[l(`div`,k,r(W.value.score),1),t[3]||=l(`div`,{class:`meta-label`},`Рейтинг`,-1)]),l(`div`,A,[l(`div`,j,r(W.value.airedOn.year),1),t[4]||=l(`div`,{class:`meta-label`},`Год`,-1)]),l(`div`,M,[l(`div`,N,r(W.value.episodes),1),t[5]||=l(`div`,{class:`meta-label`},`Серий`,-1)]),l(`div`,P,[l(`div`,F,r(W.value.duration)+` мин.`,1),t[6]||=l(`div`,{class:`meta-label`},`Длительность`,-1)]),l(`div`,I,[l(`div`,L,r(W.value.kind),1),t[7]||=l(`div`,{class:`meta-label`},`Статус`,-1)])]),l(`div`,R,[(g(!0),h(m,null,o(W.value.genres,(e,t)=>(g(),h(`span`,{key:t},r(e.russian||e.name),1))),128))]),l(`div`,{class:`anime__info-desc`,innerHTML:ve.value},null,8,pe),l(`div`,z,[c(u,{class:`anime__info-btn primary-btn`,to:`/watch/${W.value.id}`},{default:te(()=>[c(a,{icon:`fa-solid fa-play`}),t[8]||=_(` Смотреть сейчас `,-1)]),_:1},8,[`to`]),l(`button`,B,[c(a,{icon:`fa-solid fa-share`}),t[9]||=_(` Поделиться `,-1)])])])])])):s(``,!0)])]),c(oe)],64)}}},[[`__scopeId`,`data-v-8185590e`]]);export{V as default};